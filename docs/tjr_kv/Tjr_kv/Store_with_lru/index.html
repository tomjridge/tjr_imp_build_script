<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store_with_lru (tjr_kv.Tjr_kv.Store_with_lru)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">tjr_kv</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Tjr_kv.Store_with_lru</span></h1></header><p>A KV store with the LRU frontend.</p><p>We construct:</p><ul><li>XXX Actually, work with references first XXX Functional store thread</li><li>this maintains the &quot;global&quot; state, including locks etc</li><li>the queues are kept separate since they are implemented using mutation anyway FIXME perhaps prefer a &quot;functional&quot; version using the functional store</li><li>includes:</li><li>lru_state</li><li>dcl_state</li><li>bt_state (a root pointer?)</li><li>also includes an Lwt_mvar for communication and implementation of with_state</li></ul><ul><li>LRU</li><li>q_lru_dcl (msg queue from lru to dcl)</li><li>Lru (and lru_state)</li><li>Lru_t, which takes messages from lru.to_lower to enqueue on q_lru_dcl</li></ul><ul><li>DCL</li><li>q_dcl_bt (msg queue from dcl to btree)</li><li>DCL (detachable chunked list) and dcl_state</li><li>DCL thread (Dcl_t)</li><li>takes msgs from q_dcl_btree and executes against dcl and B-tree</li></ul><ul><li>B-tree</li><li>B-tree</li><li>B-tree thread (Btree_t) listening to q_dcl_btree</li><li>also includes root pair functionality</li></ul><div class="spec val" id="val-lru_max_size"><a href="#val-lru_max_size" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lru_max_size : int</code></div><div class="doc"></div></div><div class="spec val" id="val-lru_evict_count"><a href="#val-lru_evict_count" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lru_evict_count : int</code></div><div class="doc"></div></div><div class="spec val" id="val-dcl_ops_per_block"><a href="#val-dcl_ops_per_block" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dcl_ops_per_block : int</code></div><div class="doc"></div></div><div class="spec val" id="val-pcache_blocks_limit"><a href="#val-pcache_blocks_limit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pcache_blocks_limit : int</code></div><div class="doc"></div></div><div class="spec val" id="val-dcl_thread_delay"><a href="#val-dcl_thread_delay" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dcl_thread_delay : float</code></div><div class="doc"></div></div><div class="spec val" id="val-bt_thread_delay"><a href="#val-bt_thread_delay" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bt_thread_delay : float</code></div><div class="doc"></div></div><div class="spec val" id="val-q_lru_dcl"><a href="#val-q_lru_dcl" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>q_lru_dcl : (Lwt_mutex.t, unit Lwt_condition.t, <a href="../Lwt_aux/B/index.html#type-lru_dcl_msg'">Lwt_aux.B.lru_dcl_msg'</a>) <a href="../../../tjr_mem_queue/Tjr_mem_queue/Types/index.html#type-queue">Tjr_mem_queue.Types.queue</a></code></div><div class="doc"></div></div><div class="spec val" id="val-q_lru_dcl_ops"><a href="#val-q_lru_dcl_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>q_lru_dcl_ops : <a href="../Lwt_aux/B/index.html#type-lru_dcl_msg'">Lwt_aux.B.lru_dcl_msg'</a> <a href="../Lwt_aux/Lwt_queue/index.html#type-lwt_queue_ops">Lwt_aux.Lwt_queue.lwt_queue_ops</a></code></div><div class="doc"></div></div><div class="spec module" id="module-Lru'"><a href="#module-Lru'" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Lru'/index.html">Lru'</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-q_dcl_bt"><a href="#val-q_dcl_bt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>q_dcl_bt : (Lwt_mutex.t, unit Lwt_condition.t, <a href="../Lwt_aux/C/index.html#type-dcl_bt_msg'">Lwt_aux.C.dcl_bt_msg'</a>) <a href="../../../tjr_mem_queue/Tjr_mem_queue/Types/index.html#type-queue">Tjr_mem_queue.Types.queue</a></code></div><div class="doc"></div></div><div class="spec val" id="val-q_dcl_bt_ops"><a href="#val-q_dcl_bt_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>q_dcl_bt_ops : <a href="../Lwt_aux/C/index.html#type-dcl_bt_msg'">Lwt_aux.C.dcl_bt_msg'</a> <a href="../Lwt_aux/Lwt_queue/index.html#type-lwt_queue_ops">Lwt_aux.Lwt_queue.lwt_queue_ops</a></code></div><div class="doc"></div></div><div class="spec module" id="module-Dcl'"><a href="#module-Dcl'" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Dcl'/index.html">Dcl'</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec module" id="module-Btree'"><a href="#module-Btree'" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Btree'/index.html">Btree'</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div></body></html>