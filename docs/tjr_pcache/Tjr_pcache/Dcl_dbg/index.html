<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dcl_dbg (tjr_pcache.Tjr_pcache.Dcl_dbg)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">tjr_pcache</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Tjr_pcache.Dcl_dbg</span></h1></header><p>Debug support for DCL. The spec is expressed as an abstraction
from the impl, with wf checks for transitions. Provide code to wrap
an existing dcl and check that the state changes conform to the
spec.</p><p>An alternative (executable spec) is not possible because eg we
don't necessarily assume a fixed number of ops per block. (Perhaps
we should... this makes the spec more restrictive, but allows for
an executable spec)</p><div class="spec val" id="val-set"><a href="#val-set" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set : <span class="type-var">'a</span> <a href="../../../tjr_lib_core/Tjr_store/Refs/index.html#type-r">Tjr_store.Refs.r</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a></code></div><div class="doc"></div></div><div class="spec val" id="val-get"><a href="#val-get" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get : <span class="type-var">'a</span> <a href="../../../tjr_lib_core/Tjr_store/Refs/index.html#type-r">Tjr_store.Refs.r</a> <span class="keyword">&#8209;&gt;</span> <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"></div></div><div class="spec val" id="val-mk_ref'"><a href="#val-mk_ref'" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mk_ref' : <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../../../tjr_lib_core/Tjr_store/Refs/index.html#type-r">Tjr_store.Refs.r</a></code></div><div class="doc"></div></div><div class="spec val" id="val-op_to_yojson"><a href="#val-op_to_yojson" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>op_to_yojson : <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> <span class="keyword">&#8209;&gt;</span> Yojson.Safe.json</code></div><div class="doc"></div></div><div class="spec val" id="val-op_of_yojson"><a href="#val-op_of_yojson" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>op_of_yojson : <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'d</span></code></div><div class="doc"></div></div><div class="spec type" id="type-find_result"><a href="#type-find_result" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>find_result</code><code><span class="keyword"> = </span>(int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> option</code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-find_result_to_yojson"><a href="#val-find_result_to_yojson" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find_result_to_yojson : <a href="index.html#type-find_result">find_result</a> <span class="keyword">&#8209;&gt;</span> Yojson.Safe.json</code></div><div class="doc"></div></div><div class="spec val" id="val-find_result_of_yojson"><a href="#val-find_result_of_yojson" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find_result_of_yojson : Yojson.Safe.json <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-find_result">find_result</a> Ppx_deriving_yojson_runtime.error_or</code></div><div class="doc"></div></div><div class="spec type" id="type-dbg"><a href="#type-dbg" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>dbg</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-dbg.dbg_current" class="anchored"><td class="def field"><a href="#type-dbg.dbg_current" class="anchor"></a><code>dbg_current : (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list;</code></td></tr><tr id="type-dbg.dbg_past" class="anchored"><td class="def field"><a href="#type-dbg.dbg_past" class="anchor"></a><code>dbg_past : (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>The abstract representation for the DCL spec. Essentially it is the
list divided into the &quot;current&quot; block and the previous blocks (and
each block corresponds to a list of operations).</p><p>FIXME order of lists? reversed (most recent first) - assoc lists</p><p>NOTE specialized to <code class="code">int -&gt; int</code></p></div></div><div class="spec val" id="val-dbg_to_yojson"><a href="#val-dbg_to_yojson" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dbg_to_yojson : <a href="index.html#type-dbg">dbg</a> <span class="keyword">&#8209;&gt;</span> Yojson.Safe.json</code></div><div class="doc"></div></div><div class="spec val" id="val-dbg_of_yojson"><a href="#val-dbg_of_yojson" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dbg_of_yojson : Yojson.Safe.json <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-dbg">dbg</a> Ppx_deriving_yojson_runtime.error_or</code></div><div class="doc"></div></div><div class="spec val" id="val-init_dbg"><a href="#val-init_dbg" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>init_dbg : <a href="index.html#type-dbg">dbg</a></code></div><div class="doc"></div></div><div class="spec val" id="val-dbg2list"><a href="#val-dbg2list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dbg2list : <a href="index.html#type-dbg">dbg</a> <span class="keyword">&#8209;&gt;</span> (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list</code></div><div class="doc"><p>Convert the dbg state into a simple list</p></div></div><div class="spec val" id="val-dbg2assoc_list"><a href="#val-dbg2assoc_list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dbg2assoc_list : <a href="index.html#type-dbg">dbg</a> <span class="keyword">&#8209;&gt;</span> (int<span class="keyword"> * </span>(int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a>) list</code></div><div class="doc"></div></div><div class="spec val" id="val-find"><a href="#val-find" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find : int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-dbg">dbg</a> <span class="keyword">&#8209;&gt;</span> (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> option</code></div><div class="doc"><p>Implement the find operation on dbg state</p></div></div><div class="spec val" id="val-dcl_to_dbg"><a href="#val-dcl_to_dbg" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dcl_to_dbg : pcl_to_list:(start_block:<span class="type-var">'ptr</span> <span class="keyword">&#8209;&gt;</span> blks:<span class="type-var">'blks</span> <span class="keyword">&#8209;&gt;</span> (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list list) <span class="keyword">&#8209;&gt;</span> blks:<span class="type-var">'blks</span> <span class="keyword">&#8209;&gt;</span> dcl:(<span class="type-var">'map</span>, <span class="type-var">'ptr</span>) <a href="../Detachable_chunked_list/index.html#type-dcl_state">Detachable_chunked_list.dcl_state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-dbg">dbg</a></code></div><div class="doc"><p>Map the DCL state to a <code class="code">dbg</code> state</p></div></div><p>NOTE the dbg state is derived from the dcl state; we don't need to
explicitly store it</p><div class="spec val" id="val-make_checked_dcl_ops"><a href="#val-make_checked_dcl_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_checked_dcl_ops : monad_ops:<span class="type-var">'t</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> dcl_ops:(int, int, <span class="type-var">'map</span>, <span class="type-var">'ptr</span>, <span class="type-var">'t</span>) <a href="../Detachable_chunked_list/index.html#type-dcl_ops">Detachable_chunked_list.dcl_ops</a> <span class="keyword">&#8209;&gt;</span> get_dbg:(unit <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-dbg">dbg</a>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> (int, int, <span class="type-var">'map</span>, <span class="type-var">'ptr</span>, <span class="type-var">'t</span>) <a href="../Detachable_chunked_list/index.html#type-dcl_ops">Detachable_chunked_list.dcl_ops</a></code></div><div class="doc"><p>Take an existing <code class="code">dcl_ops</code>, and add testing code based on the dbg state</p><p>FIXME maybe prefer exhaustive testing rather than wrapping the monadic ops</p></div></div></body></html>