<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dmap_example (tjr_pcache.Tjr_pcache.Dmap_example)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">tjr_pcache</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Tjr_pcache.Dmap_example</span></h1></header><p>An example use of the detachable map, for an on-disk persistent
cache, with key type int, value type int</p><p>Suppose the block size is B bytes. Then we need xxx bytes (1 for list
elt, 1 for option tag, 9 for ptr; xxx=11) for the End_of_list
marker.</p><ul><li>(B-xxx) bytes are available for data</li></ul><p>When we write eg Insert(k,v), we potentially use 1+|k|+|v| bytes. We
need to be very careful that this doesn't exceed the B-xxx
limit. Particularly, if values can be largeish (eg 256 bytes) we
need to take great care.</p><div class="spec type" id="type-buf"><a href="#type-buf" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>buf</code><code><span class="keyword"> = </span>Bin_prot.Common.buf</code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-create_buf"><a href="#val-create_buf" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>create_buf : int <span class="keyword">&#8209;&gt;</span> Bin_prot.Common.buf</code></div><div class="doc"></div></div><div class="spec type" id="type-config"><a href="#type-config" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('k, 'v, 'ptr) config</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-config.ptr_sz" class="anchored"><td class="def field"><a href="#type-config.ptr_sz" class="anchor"></a><code>ptr_sz : int;</code></td></tr><tr id="type-config.blk_sz" class="anchored"><td class="def field"><a href="#type-config.blk_sz" class="anchor"></a><code>blk_sz : int;</code></td></tr><tr id="type-config.k_size" class="anchored"><td class="def field"><a href="#type-config.k_size" class="anchor"></a><code>k_size : int;</code></td></tr><tr id="type-config.v_size" class="anchored"><td class="def field"><a href="#type-config.v_size" class="anchor"></a><code>v_size : int;</code></td></tr><tr id="type-config.k_writer" class="anchored"><td class="def field"><a href="#type-config.k_writer" class="anchor"></a><code>k_writer : <span class="type-var">'k</span> Bin_prot.Type_class.writer;</code></td></tr><tr id="type-config.k_reader" class="anchored"><td class="def field"><a href="#type-config.k_reader" class="anchor"></a><code>k_reader : <span class="type-var">'k</span> Bin_prot.Type_class.reader;</code></td></tr><tr id="type-config.v_writer" class="anchored"><td class="def field"><a href="#type-config.v_writer" class="anchor"></a><code>v_writer : <span class="type-var">'v</span> Bin_prot.Type_class.writer;</code></td></tr><tr id="type-config.v_reader" class="anchored"><td class="def field"><a href="#type-config.v_reader" class="anchor"></a><code>v_reader : <span class="type-var">'v</span> Bin_prot.Type_class.reader;</code></td></tr><tr id="type-config.ptr_writer" class="anchored"><td class="def field"><a href="#type-config.ptr_writer" class="anchor"></a><code>ptr_writer : <span class="type-var">'ptr</span> Bin_prot.Type_class.writer;</code></td></tr><tr id="type-config.ptr_reader" class="anchored"><td class="def field"><a href="#type-config.ptr_reader" class="anchor"></a><code>ptr_reader : <span class="type-var">'ptr</span> Bin_prot.Type_class.reader;</code></td></tr><tr id="type-config.ptr0" class="anchored"><td class="def field"><a href="#type-config.ptr0" class="anchor"></a><code>ptr0 : <span class="type-var">'ptr</span>;</code></td></tr><tr id="type-config.next_free_ptr" class="anchored"><td class="def field"><a href="#type-config.next_free_ptr" class="anchor"></a><code>next_free_ptr : <span class="type-var">'ptr</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'ptr</span>;</code></td></tr></table><code>}</code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-end_of_list_sz"><a href="#val-end_of_list_sz" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>end_of_list_sz : config:(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"></div></div><div class="spec val" id="val-max_data_length"><a href="#val-max_data_length" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>max_data_length : config:(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"></div></div><div class="spec module" id="module-Elt"><a href="#module-Elt" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Elt/index.html">Elt</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><a href="index.html#module-Elt">Elt</a></code></span></summary><div class="spec type" id="type-elt"><a href="#type-elt" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('k, 'v, 'ptr) elt</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-elt.Insert" class="anchored"><td class="def constructor"><a href="#type-elt.Insert" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Insert</span><span class="keyword"> of </span><span class="type-var">'k</span><span class="keyword"> * </span><span class="type-var">'v</span></code></td></tr><tr id="type-elt.Delete" class="anchored"><td class="def constructor"><a href="#type-elt.Delete" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Delete</span><span class="keyword"> of </span><span class="type-var">'k</span></code></td></tr><tr id="type-elt.End_of_list" class="anchored"><td class="def constructor"><a href="#type-elt.End_of_list" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">End_of_list</span><span class="keyword"> of </span><span class="type-var">'ptr</span> option</code></td></tr></table><code></code></div><div class="doc"><p>For marshalling, we have a seq of elts, where the last elt is a
End_of_list. The empty seq is just a single elt End_of_list</p></div></div><div class="spec val" id="val-bin_shape_elt"><a href="#val-bin_shape_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_shape_elt : Bin_prot.Shape.t <span class="keyword">&#8209;&gt;</span> Bin_prot.Shape.t <span class="keyword">&#8209;&gt;</span> Bin_prot.Shape.t <span class="keyword">&#8209;&gt;</span> Bin_prot.Shape.t</code></div><div class="doc"></div></div><div class="spec val" id="val-bin_size_elt"><a href="#val-bin_size_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_size_elt : (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> int) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> int) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> Bin_prot.Std.sizer <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"></div></div><div class="spec val" id="val-bin_write_elt"><a href="#val-bin_write_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_write_elt : (Bin_prot.Common.buf <span class="keyword">&#8209;&gt;</span> pos:Bin_prot.Common.pos <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> Bin_prot.Common.pos) <span class="keyword">&#8209;&gt;</span> (Bin_prot.Common.buf <span class="keyword">&#8209;&gt;</span> pos:Bin_prot.Common.pos <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> Bin_prot.Common.pos) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> Bin_prot.Write.writer <span class="keyword">&#8209;&gt;</span> Bin_prot.Common.buf <span class="keyword">&#8209;&gt;</span> pos:Bin_prot.Common.pos <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> <span class="keyword">&#8209;&gt;</span> Bin_prot.Common.pos</code></div><div class="doc"></div></div><div class="spec val" id="val-bin_writer_elt"><a href="#val-bin_writer_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_writer_elt : <span class="type-var">'a</span> Bin_prot.Type_class.writer <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> Bin_prot.Type_class.writer <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> Bin_prot.Type_class.writer <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> Bin_prot.Type_class.writer</code></div><div class="doc"></div></div><div class="spec val" id="val-__bin_read_elt__"><a href="#val-__bin_read_elt__" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>__bin_read_elt__ : <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'d</span> <span class="keyword">&#8209;&gt;</span> pos_ref:Bin_prot.Common.pos Pervasives.ref <span class="keyword">&#8209;&gt;</span> <span class="type-var">'e</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'f</span></code></div><div class="doc"></div></div><div class="spec val" id="val-bin_read_elt"><a href="#val-bin_read_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_read_elt : (Bin_prot.Common.buf <span class="keyword">&#8209;&gt;</span> pos_ref:Bin_prot.Common.pos_ref <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span>) <span class="keyword">&#8209;&gt;</span> (Bin_prot.Common.buf <span class="keyword">&#8209;&gt;</span> pos_ref:Bin_prot.Common.pos_ref <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> Bin_prot.Read.reader <span class="keyword">&#8209;&gt;</span> Bin_prot.Common.buf <span class="keyword">&#8209;&gt;</span> pos_ref:Bin_prot.Common.pos_ref <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a></code></div><div class="doc"></div></div><div class="spec val" id="val-bin_reader_elt"><a href="#val-bin_reader_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_reader_elt : <span class="type-var">'a</span> Bin_prot.Type_class.reader <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> Bin_prot.Type_class.reader <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> Bin_prot.Type_class.reader <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> Bin_prot.Type_class.reader</code></div><div class="doc"></div></div><div class="spec val" id="val-bin_elt"><a href="#val-bin_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>bin_elt : <span class="type-var">'a</span> Bin_prot.Type_class.t <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> Bin_prot.Type_class.t <span class="keyword">&#8209;&gt;</span> <span class="type-var">'c</span> Bin_prot.Type_class.t <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> Bin_prot.Type_class.t</code></div><div class="doc"></div></div><div class="spec val" id="val-elt_writer"><a href="#val-elt_writer" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>elt_writer : config:(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> Bin_prot.Type_class.writer</code></div><div class="doc"></div></div><div class="spec val" id="val-elt_reader"><a href="#val-elt_reader" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>elt_reader : config:(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-elt">elt</a> Bin_prot.Type_class.reader</code></div><div class="doc"></div></div></details></div><div class="spec type" id="type-pl_state"><a href="#type-pl_state" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'ptr pl_state</code><code><span class="keyword"> = </span>(<a href="index.html#type-buf">buf</a><span class="keyword"> * </span>int, <span class="type-var">'ptr</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-pl_state_ops"><a href="#val-pl_state_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pl_state_ops : (<span class="type-var">'a</span>, <span class="type-var">'b</span>, (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a>) <a href="../Pl_types/index.html#type-pl_state_ops">Pl_types.pl_state_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-write_node"><a href="#val-write_node" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>write_node : config:(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'ptr</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> blk_dev_ops:(<span class="type-var">'ptr</span>, string, <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="../Blk_dev/index.html#type-blk_dev_ops">Blk_dev.blk_dev_ops</a> <span class="keyword">&#8209;&gt;</span> dev:<span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'ptr</span> <a href="index.html#type-pl_state">pl_state</a> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'d</span>) <a href="../../../tjr_monad/Tjr_monad/Monad_ops/index.html#type-m">Tjr_monad.Monad_ops.m</a></code></div><div class="doc"></div></div><div class="spec val" id="val-read_node"><a href="#val-read_node" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read_node : monad_ops:<span class="type-var">'a</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> config:(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'ptr</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> blk_dev_ops:(<span class="type-var">'b</span>, string, <span class="type-var">'c</span>, <span class="type-var">'a</span>) <a href="../Blk_dev/index.html#type-blk_dev_ops">Blk_dev.blk_dev_ops</a> <span class="keyword">&#8209;&gt;</span> dev:<span class="type-var">'c</span> <span class="keyword">&#8209;&gt;</span> blk_id:<span class="type-var">'b</span> <span class="keyword">&#8209;&gt;</span> ((<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list<span class="keyword"> * </span><span class="type-var">'ptr</span> option, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a></code></div><div class="doc"></div></div><div class="spec type" id="type-pcl_state"><a href="#type-pcl_state" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>pcl_state</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-pcl_state.data" class="anchored"><td class="def field"><a href="#type-pcl_state.data" class="anchor"></a><code>data : <a href="index.html#type-buf">buf</a><span class="keyword"> * </span>int;</code></td></tr></table><code>}</code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-pcl_state_ops"><a href="#val-pcl_state_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pcl_state_ops : config:(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'ptr</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-buf">buf</a><span class="keyword"> * </span>int, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a>, <a href="index.html#type-pcl_state">pcl_state</a>) <a href="../Pcl_types/index.html#type-pcl_state_ops">Pcl_types.pcl_state_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-make_pl_ops'"><a href="#val-make_pl_ops'" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_pl_ops' : monad_ops:<span class="type-var">'a</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> write_node:((<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> with_pl:((<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a>, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-with_state">Tjr_monad.Types.with_state</a> <span class="keyword">&#8209;&gt;</span> alloc:(unit <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'c</span>, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'a</span>) <a href="../Pl_types/index.html#type-pl_ops">Pl_types.pl_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-make_pcl_ops'"><a href="#val-make_pcl_ops'" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_pcl_ops' : monad_ops:<span class="type-var">'a</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> config:(<span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> write_node:((<a href="index.html#type-buf">buf</a><span class="keyword"> * </span>int, <span class="type-var">'e</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> alloc:(unit <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'e</span>, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> with_pl:((<a href="index.html#type-buf">buf</a><span class="keyword"> * </span>int, <span class="type-var">'e</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a>, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-with_state">Tjr_monad.Types.with_state</a> <span class="keyword">&#8209;&gt;</span> with_pcl:(<a href="index.html#type-pcl_state">pcl_state</a>, <span class="type-var">'a</span>) <a href="../../../tjr_monad/Tjr_monad/With_state/index.html#type-with_state">Tjr_monad.With_state.with_state</a> <span class="keyword">&#8209;&gt;</span> ((<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a>, <span class="type-var">'e</span>, <span class="type-var">'a</span>) <a href="../Persistent_chunked_list/index.html#type-pcl_ops">Persistent_chunked_list.pcl_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-make_dmap_dcl_ops'"><a href="#val-make_dmap_dcl_ops'" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_dmap_dcl_ops' : monad_ops:<span class="type-var">'t</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> config:(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'ptr</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> write_node:(<span class="type-var">'ptr</span> <a href="index.html#type-pl_state">pl_state</a> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> alloc:(unit <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ptr</span>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> with_pl:((<a href="index.html#type-buf">buf</a><span class="keyword"> * </span>int, <span class="type-var">'ptr</span>) <a href="../Pl_simple_implementation/index.html#type-pl_state">Pl_simple_implementation.pl_state</a>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-with_state">Tjr_monad.Types.with_state</a> <span class="keyword">&#8209;&gt;</span> with_pcl:(<a href="index.html#type-pcl_state">pcl_state</a>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/With_state/index.html#type-with_state">Tjr_monad.With_state.with_state</a> <span class="keyword">&#8209;&gt;</span> with_dmap:((<span class="type-var">'ptr</span>, <span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="../Detachable_map/index.html#type-dmap_state">Detachable_map.dmap_state</a>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/With_state/index.html#type-with_state">Tjr_monad.With_state.with_state</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ptr</span>, <span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'t</span>) <a href="../Detachable_map/index.html#type-dmap_dcl_ops">Detachable_map.dmap_dcl_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-make_dmap_ops_with_fun_store"><a href="#val-make_dmap_ops_with_fun_store" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_dmap_ops_with_fun_store : config:(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'ptr</span>) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> write_node:(<span class="type-var">'ptr</span> <a href="index.html#type-pl_state">pl_state</a> <span class="keyword">&#8209;&gt;</span> (unit, <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>) <span class="keyword">&#8209;&gt;</span> store:<a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a><span class="keyword"> * </span>(<span class="type-var">'ptr</span>, <span class="type-var">'k</span>, <span class="type-var">'v</span>, <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a>) <a href="../Detachable_map/index.html#type-dmap_dcl_ops">Detachable_map.dmap_dcl_ops</a></code></div><div class="doc"><p>Construct dcl ops on top of a functional store.</p></div></div><p>Construct write_node on top of a blk_dev</p><div class="spec val" id="val-make_dmap_ops_on_file"><a href="#val-make_dmap_ops_on_file" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_dmap_ops_on_file : monad_ops:<a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a> <a href="../../../tjr_monad/Tjr_monad/Monad_ops/index.html#type-monad_ops">Tjr_monad.Monad_ops.monad_ops</a> <span class="keyword">&#8209;&gt;</span> config:(<span class="type-var">'a</span>, <span class="type-var">'b</span>, int) <a href="index.html#type-config">config</a> <span class="keyword">&#8209;&gt;</span> fn:string <span class="keyword">&#8209;&gt;</span> Unix.file_descr<span class="keyword"> * </span><a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a><span class="keyword"> * </span>(int, <span class="type-var">'a</span>, <span class="type-var">'b</span>, <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a>) <a href="../Detachable_map/index.html#type-dmap_dcl_ops">Detachable_map.dmap_dcl_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-int_int_config"><a href="#val-int_int_config" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>int_int_config : (int, int, int) <a href="index.html#type-config">config</a></code></div><div class="doc"></div></div><div class="spec val" id="val-config"><a href="#val-config" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>config : (int, int, int) <a href="index.html#type-config">config</a></code></div><div class="doc"></div></div><div class="spec val" id="val-monad_ops"><a href="#val-monad_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>monad_ops : <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a> <a href="../../../tjr_monad/Tjr_monad/Monad_ops/index.html#type-monad_ops">Tjr_monad.Monad_ops.monad_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-blk_dev_on_file"><a href="#val-blk_dev_on_file" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>blk_dev_on_file : (int, string, Unix.file_descr, <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a>) <a href="../../Tjr_pcache__Blk_dev/index.html#type-blk_dev_ops">Tjr_pcache__Blk_dev.blk_dev_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-test_dmap_ops_on_file"><a href="#val-test_dmap_ops_on_file" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>test_dmap_ops_on_file : fn:string <span class="keyword">&#8209;&gt;</span> count:int <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"></div></div><div class="spec val" id="val-read_node"><a href="#val-read_node" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read_node : dev:Unix.file_descr <span class="keyword">&#8209;&gt;</span> blk_id:int <span class="keyword">&#8209;&gt;</span> ((int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list<span class="keyword"> * </span>int option, <a href="../../../tjr_lib_core/Tjr_store/index.html#type-t">Tjr_store.t</a> <a href="../../../tjr_monad/Tjr_monad/State_passing/index.html#type-state_passing">Tjr_monad.State_passing.state_passing</a>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a></code></div><div class="doc"></div></div><div class="spec val" id="val-read_back"><a href="#val-read_back" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read_back : fn:string <span class="keyword">&#8209;&gt;</span> (int, int) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a> list list</code></div><div class="doc"></div></div></body></html>