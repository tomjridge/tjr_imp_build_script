<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Detachable_map (tjr_pcache.Tjr_pcache.Detachable_map)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">tjr_pcache</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Tjr_pcache.Detachable_map</span></h1></header><p>As <a href="../Detachable_chunked_list/index.html">Detachable_chunked_list</a>, but with the operations insert and
delete; and the abstract view a map.</p><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><a href="../index.html#module-Dmap_types">Dmap_types</a></code></span></summary><p>A dmap is effectively just a DCL with a refined 'op type and 'abs
type. However, we also include functionality to convert to a
standard map interface (not one based on ops).</p><div class="spec type" id="type-op"><a href="#type-op" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('k, 'v) op</code><code><span class="keyword"> = </span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a></code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-op_map"><a href="#type-op_map" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('k, 'v) op_map</code><code><span class="keyword"> = </span>(<span class="type-var">'k</span>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op">op</a>) <a href="../../../tjr_polymap/Tjr_polymap/index.html#type-t">Tjr_polymap.t</a></code><code></code></div><div class="doc"><p>Abbreviation; FIXME move to Ins_del_op_type</p></div></div><div class="spec type" id="type-dmap_state"><a href="#type-dmap_state" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('ptr, 'k, 'v) dmap_state</code><code><span class="keyword"> = </span>(<span class="type-var">'ptr</span>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op_map">op_map</a>) <a href="../Dcl_types/index.html#type-dcl_state">Dcl_types.dcl_state</a></code><code></code></div><div class="doc"><p>NOTE dmap_state is just an abbreviation for dcl_state</p></div></div><div class="spec val" id="val-internal_"><a href="#val-internal_" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>internal_ : ptr:<span class="type-var">'ptr</span> <span class="keyword">&#8209;&gt;</span> abs:(<span class="type-var">'k</span>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op">op</a>) <a href="../../../tjr_polymap/Tjr_polymap/index.html#type-t">Tjr_polymap.t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"></div></div><div class="spec type" id="type-dmap_dcl_ops"><a href="#type-dmap_dcl_ops" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('ptr, 'k, 'v, 't) dmap_dcl_ops</code><code><span class="keyword"> = </span>((<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op">op</a>, (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op_map">op_map</a>, <span class="type-var">'ptr</span>, <span class="type-var">'t</span>) <a href="../Dcl_types/index.html#type-dcl_ops">Dcl_types.dcl_ops</a></code><code></code></div><div class="doc"><p>NOTE dmap_dcl_ops is just an abbreviation for dcl_ops with:</p><ul><li>'op the type of kv op</li><li>'abs the type of kv op_map</li></ul></div></div><div class="spec type" id="type-detach_info"><a href="#type-detach_info" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('k, 'v, 'ptr) detach_info</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-detach_info.past_map" class="anchored"><td class="def field"><a href="#type-detach_info.past_map" class="anchor"></a><code>past_map : (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op_map">op_map</a>;</code></td></tr><tr id="type-detach_info.current_map" class="anchored"><td class="def field"><a href="#type-detach_info.current_map" class="anchor"></a><code>current_map : (<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-op_map">op_map</a>;</code></td></tr><tr id="type-detach_info.current_ptr" class="anchored"><td class="def field"><a href="#type-detach_info.current_ptr" class="anchor"></a><code>current_ptr : <span class="type-var">'ptr</span>;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>The result of &quot;detaching&quot; the map. We get the abstract map for all
but the current node, and information about the current node.</p></div></div><div class="spec type" id="type-dmap_ops"><a href="#type-dmap_ops" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>('k, 'v, 'ptr, 't) dmap_ops</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-dmap_ops.find" class="anchored"><td class="def field"><a href="#type-dmap_ops.find" class="anchor"></a><code>find : <span class="type-var">'k</span> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'v</span> option, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>;</code></td></tr><tr id="type-dmap_ops.insert" class="anchored"><td class="def field"><a href="#type-dmap_ops.insert" class="anchor"></a><code>insert : <span class="type-var">'k</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'v</span> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>;</code></td></tr><tr id="type-dmap_ops.delete" class="anchored"><td class="def field"><a href="#type-dmap_ops.delete" class="anchor"></a><code>delete : <span class="type-var">'k</span> <span class="keyword">&#8209;&gt;</span> (unit, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>;</code></td></tr><tr id="type-dmap_ops.detach" class="anchored"><td class="def field"><a href="#type-dmap_ops.detach" class="anchor"></a><code>detach : unit <span class="keyword">&#8209;&gt;</span> ((<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'ptr</span>) <a href="index.html#type-detach_info">detach_info</a>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>;</code></td></tr><tr id="type-dmap_ops.block_list_length" class="anchored"><td class="def field"><a href="#type-dmap_ops.block_list_length" class="anchor"></a><code>block_list_length : unit <span class="keyword">&#8209;&gt;</span> (int, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-m">Tjr_monad.Types.m</a>;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>For the detach operation, we get the map upto the current node,
and the map for the current node</p></div></div></details></div><div class="spec val" id="val-make_dmap_dcl_ops"><a href="#val-make_dmap_dcl_ops" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_dmap_dcl_ops : monad_ops:<span class="type-var">'t</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> pcl_ops:((<span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a>, <span class="type-var">'ptr</span>, <span class="type-var">'t</span>) <a href="../Pcl_types/index.html#type-pcl_ops">Pcl_types.pcl_ops</a> <span class="keyword">&#8209;&gt;</span> with_dmap:((<span class="type-var">'ptr</span>, <span class="type-var">'k</span>, <span class="type-var">'v</span>) <a href="index.html#type-dmap_state">dmap_state</a>, <span class="type-var">'t</span>) <a href="../../../tjr_monad/Tjr_monad/With_state/index.html#type-with_state">Tjr_monad.With_state.with_state</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'ptr</span>, <span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'t</span>) <a href="index.html#type-dmap_dcl_ops">dmap_dcl_ops</a></code></div><div class="doc"></div></div><div class="spec val" id="val-convert_dcl_to_dmap"><a href="#val-convert_dcl_to_dmap" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>convert_dcl_to_dmap : monad_ops:<span class="type-var">'a</span> <a href="../../../tjr_monad/Tjr_monad/Types/index.html#type-monad_ops">Tjr_monad.Types.monad_ops</a> <span class="keyword">&#8209;&gt;</span> dmap_dcl_ops:((<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="../Ins_del_op_type/index.html#type-op">Ins_del_op_type.op</a>, (<span class="type-var">'b</span>, <span class="type-var">'c</span>) <a href="index.html#type-op_map">op_map</a>, <span class="type-var">'d</span>, <span class="type-var">'a</span>) <a href="../Detachable_chunked_list/index.html#type-dcl_ops">Detachable_chunked_list.dcl_ops</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>, <span class="type-var">'a</span>) <a href="../Dmap_types/index.html#type-dmap_ops">Dmap_types.dmap_ops</a></code></div><div class="doc"></div></div></body></html>